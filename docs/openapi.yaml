openapi: 3.0.3
info:
  title: Engine-Ops API
  description: |
    Enterprise-grade optimization engine for Kubernetes resource optimization, 
    cost analytics, and intelligent workload scheduling.
    
    ## Features
    - Real-time optimization with WebSocket updates
    - Advanced algorithms (Genetic, Simulated Annealing, Bin Packing)
    - Prometheus metrics and OpenTelemetry tracing
    - Multi-language SDKs (Python, Go)
    - Production-ready with RBAC and authentication
    
  version: 0.3.0
  contact:
    name: HUMMBL, LLC
    email: hummbldev@gmail.com
    url: https://github.com/hummbl-dev/engine-ops
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:3000
    description: Local development
  - url: https://api.engine-ops.io
    description: Production

tags:
  - name: Optimization
    description: Core optimization endpoints
  - name: Health
    description: Health check and monitoring
  - name: Metrics
    description: Performance and cost metrics
  - name: Cache
    description: Cache management

security:
  - ApiKeyAuth: []
  - BearerAuth: []

paths:
  /:
    get:
      summary: API Information
      tags: [Health]
      security: []
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                  version:
                    type: string
                  description:
                    type: string

  /api/v1/optimize:
    post:
      summary: Submit optimization request
      tags: [Optimization]
      description: |
        Submit a workload optimization request. Supports multiple optimization types
        including resource allocation, scheduling, and cost optimization.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OptimizationRequest'
            examples:
              kubernetes-pod-placement:
                summary: Kubernetes Pod Placement
                value:
                  id: k8s-pod-123
                  type: resource
                  data:
                    items:
                      - id: nginx-pod
                        cpu: 500
                        memory: 1024
                      - id: redis-pod
                        cpu: 250
                        memory: 512
                    nodeCapacity:
                      cpu: 2000
                      memory: 4096
      responses:
        '200':
          description: Optimization completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OptimizationResult'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
        '500':
          description: Internal server error

  /api/v1/health:
    get:
      summary: Health check
      tags: [Health]
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  uptime:
                    type: number
                  timestamp:
                    type: number

  /api/v1/health/live:
    get:
      summary: Liveness probe
      tags: [Health]
      security: []
      responses:
        '200':
          description: Service is alive

  /api/v1/health/ready:
    get:
      summary: Readiness probe
      tags: [Health]
      security: []
      responses:
        '200':
          description: Service is ready

  /api/v1/metrics:
    get:
      summary: Get performance metrics
      tags: [Metrics]
      responses:
        '200':
          description: Performance metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  aggregated:
                    type: object
                  recent:
                    type: array

  /api/v1/cache/stats:
    get:
      summary: Get cache statistics
      tags: [Cache]
      responses:
        '200':
          description: Cache statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  size:
                    type: number
                  maxSize:
                    type: number
                  hitRate:
                    type: number

  /metrics:
    get:
      summary: Prometheus metrics
      tags: [Metrics]
      security: []
      responses:
        '200':
          description: Prometheus metrics in text format
          content:
            text/plain:
              schema:
                type: string

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication

  schemas:
    OptimizationRequest:
      type: object
      required:
        - id
        - type
        - data
      properties:
        id:
          type: string
          description: Unique request identifier
          example: req-123
        type:
          type: string
          enum: [resource, scheduling, performance, genetic, simulated-annealing]
          description: Type of optimization
        data:
          type: object
          description: Request-specific data
          additionalProperties: true

    OptimizationResult:
      type: object
      properties:
        requestId:
          type: string
        success:
          type: boolean
        result:
          type: object
          additionalProperties: true
        error:
          type: string
          nullable: true
        metrics:
          type: object
          properties:
            durationMs:
              type: number
            score:
              type: number

    Error:
      type: object
      properties:
        error:
          type: string
        details:
          type: object
          additionalProperties: true
