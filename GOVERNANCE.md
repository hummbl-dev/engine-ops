# Governance & Guardrails

The Sovereign Intelligence Stack implements a robust governance layer to ensure safe, compliant, and auditable AI operations. This document outlines the core components of the governance system.

## Core Components

### 1. Policy Engine (`agentic_workflow/policy.py`)

The Policy Engine is the runtime enforcer of the "Constitution". It evaluates every agent action against a set of rules before execution.

- **Rule-Based Evaluation:** Policies are defined as `PolicyRule` objects with conditions, actions, and escalation levels.
- **Escalation Management:** Violations can trigger different actions:
  - `ALLOW`: Proceed as normal.
  - `LOG`: Proceed but log a warning.
  - `ESCALATE`: Pause execution and notify a human or higher-level agent.
  - `DENY`: Block the action immediately.
  - `REQUIRE_APPROVAL`: Suspend execution until explicit approval is granted.

**Default Rules:**

- **High Privilege Access:** Operations requiring elevated permissions need approval.
- **Resource Limits:** Prevents agents from consuming excessive memory (>8GB).
- **Critical Deadlines:** Ensures critical tasks have defined deadlines.

### 2. Audit Logging (`agentic_workflow/telemetry.py`)

The Audit System provides an immutable record of all system activities.

- **Structured Telemetry:** All events (Agent Start, Complete, Error, Policy Eval) are recorded with trace IDs.
- **Traceability:** Every action is linked to a `trace_id` and `span_id`, allowing full reconstruction of workflow execution.
- **Audit Reports:** The system generates comprehensive JSON audit reports containing:
  - Execution summary (duration, status)
  - Identity information (who initiated it)
  - Security context (classification, encryption)
  - Full event log
  - Compliance status

### 3. Compliance Verification (`agentic_workflow/agents/audit_agent.py`)

The `AuditAgent` runs at the end of workflows to verify compliance.

- **Automated Checks:** Verifies that all required policies were followed.
- **Compliance Records:** Generates artifacts proving compliance (e.g., "Security Audit: Compliant").
- **Gap Analysis:** Identifies missing telemetry or unapproved actions.

## Usage

### Defining a Custom Policy

```python
from agentic_workflow.policy import PolicyRule, PolicyAction, EscalationLevel

rule = PolicyRule(
    rule_id="pii_protection",
    name="PII Protection",
    description="Prevent PII in non-confidential contexts",
    condition=lambda ctx: "pii" in ctx.payload.input_data and ctx.security.data_classification != "confidential",
    action=PolicyAction.ESCALATE,
    escalation_level=EscalationLevel.CRITICAL
)
policy_engine.add_rule(rule)
```

### Generating an Audit Report

Audit reports are automatically generated by the `AuditAgent` at the end of a workflow. They can be accessed via:

```python
audit_report = result.payload.output_data["audit_report"]
```

## Security Levels

The system supports multiple data classification levels:

- **Public:** Open data, no special restrictions.
- **Internal:** Organization-only data.
- **Confidential:** Sensitive data requiring encryption and audit.
- **Restricted:** Highly sensitive data requiring specific role access.

## Future Roadmap

- **Cryptographic Signing:** Sign audit logs for tamper-proof verification.
- **External Policy Store:** Load policies from a centralized OPA (Open Policy Agent) server.
- **Real-time Monitoring:** Stream telemetry to a dashboard for live oversight.
